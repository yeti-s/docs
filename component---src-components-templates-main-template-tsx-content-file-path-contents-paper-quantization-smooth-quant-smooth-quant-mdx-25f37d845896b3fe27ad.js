"use strict";(self.webpackChunkyeti_docs=self.webpackChunkyeti_docs||[]).push([[5478],{635:function(e,t,a){a.r(t),a.d(t,{default:function(){return Q}});var n=a(1151),l=a(7294);function s(e){const t=Object.assign({h1:"h1",p:"p",span:"span",h2:"h2",a:"a",strong:"strong",code:"code",br:"br",ol:"ol",li:"li",em:"em",math:"math",semantics:"semantics",mrow:"mrow",mi:"mi",annotation:"annotation",div:"div",msub:"msub",mo:"mo",mn:"mn",mtext:"mtext",msup:"msup",mover:"mover",img:"img",pre:"pre"},(0,n.ah)(),e.components);return l.createElement(l.Fragment,null,l.createElement(t.h1,{id:"paper"},"Paper"),"\n",l.createElement(t.p,null,l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<span class="link-preview-container">\n            \n    <a target="_blank" rel="noopener noreferrer" href="https://arxiv.org/abs/2211.10438">\n        SmoothQuant: Accurate and Efficient Post-Training Quantization for Large Language Models\n    </a>\n            \n            <img\n                loading="lazy"\n                decoding="async"\n                alt="site preview image"\n                src="/static/d480462df95ef57533f700ab547aa9ea/4cda9/b1117b4a.jpg"\n                srcset="/static/d480462df95ef57533f700ab547aa9ea/4cda9/b1117b4a.jpg 1x,\n/static/d480462df95ef57533f700ab547aa9ea/3ad8d/b1117b4a.jpg 1.5x,\n/static/d480462df95ef57533f700ab547aa9ea/c60e9/b1117b4a.jpg 2x"\n                style="background-image: url(\'data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIFA//EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAHV6LDNKxP/xAAZEAEAAgMAAAAAAAAAAAAAAAABAhQABCD/2gAIAQEAAQUCpjhqRiUovH//xAAWEQADAAAAAAAAAAAAAAAAAAAAARL/2gAIAQMBAT8BplM//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGBAAAgMAAAAAAAAAAAAAAAAAARAgMTL/2gAIAQEABj8CsrUP/8QAGxABAAICAwAAAAAAAAAAAAAAAQARMWFx0eH/2gAIAQEAAT8hetR6rfJ7My5oIrbBaYYn/9oADAMBAAIAAwAAABCvL//EABkRAAIDAQAAAAAAAAAAAAAAAAABEXGR8P/aAAgBAwEBPxDiEUYj/8QAFhEAAwAAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/EIiI/8QAHRABAAMAAQUAAAAAAAAAAAAAAQARITFRYZGh0f/aAAgBAQABPxBBbNrj9jikbv6qFPP9ieWFIXnrGXa5Vy1LNn//2Q==\'); background-size: cover;"\n            />\n            \n        </span>'}})," 논문을 바탕으로 작성하였습니다."),"\n",l.createElement(t.h2,{id:"introduction"},"Introduction"),"\n",l.createElement(t.p,null,"Large-scale language model(LLM)은 다양한 분야에서 뛰어난 성과를 내고 있다.\r\n하지만 큰 모델 사이즈로 인해 LLM 서비스를 제공하는 것에는 큰 비용이 든다.\r\n예를 들어 GPT-3 모델은 175B 파라미터가 존재하고 FP16 형태로 실행하기 위해 350GB의 메모리가 필요하다.\r\n따라서 weight와 activation을 적은 비트로 quantization하는 방법으로 GPU 요구량을 줄이고 계산을 가속화할 수 있다."),"\n",l.createElement(t.p,null,"그러나 CNN모델 또는 BERT와 같은 작은 transformer 모델과 달리 LLM의 activation을 quantization하는 것은 쉽지 않다.\r\n6.7B 이상의 LLM 모델은 activation에 큰 규모의 시스템적 outliers들이 등장해서 quantization error를 증가시키고 정확도를 감소시킨다.\r\n",l.createElement(t.a,{href:"https://arxiv.org/pdf/2206.01861.pdf"},l.createElement(t.strong,null,"ZeroQuant")),"는 GPT-3-350M, GPT-J-6B 모델에서 좋은 성능을 냈지만 OPT-175B에서는 정확도를 유지하지 못했다.\r\n",l.createElement(t.a,{href:"https://arxiv.org/pdf/2208.07339.pdf"},l.createElement(t.strong,null,"LLM.int8")),"는 하드웨어 가속기에 효과적으로 decomposition을 구현하기 어렵다.\r\n그러므로 효과적, 하드웨어 친화적, 그리고 훈련이 필요 없는 quantization 방법이 필요하다."),"\n",l.createElement(t.p,null,l.createElement(t.code,null,"BERT와 같은 작은 transformer는 quantization이 쉬운 것일까?"),l.createElement(t.br),"\n",l.createElement(t.code,null,"ZeroQuant가 GPT와 OPT에서 효율이 다른 원인은 무엇인가?")),"\n",l.createElement(t.p,null,"SmoothQuant는 서로 다른 토큰에서 채널에 대한 비슷한 분포로 outlier가 존재한다는 관찰을 기반으로 한다.\r\nSmoothQuant는 quantization의 어려움을 activation에서 weight로 offline하게 이동시켰다."),"\n",l.createElement(t.p,null,l.createElement(t.code,null,"activation의 quantization이 더 어렵다는 분석 아래에 적혀 있지만 인용한 LLM.int8 논문 추가로 살펴보자.")),"\n",l.createElement(t.h2,{id:"review-of-quantization-difficulty"},"Review of Quantization Difficulty"),"\n",l.createElement(t.p,null,"LLM의 quantization을 어렵게 하는 activation outlier의 몇몇 패턴을 관측하였다.",l.createElement(t.br),"\n",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<figure class="gatsby-resp-image-figure" style="">\n    <span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 704px; "\n    >\n      <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 31.818181818181817%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABkElEQVR42iWRvW/TUBTF84+wsDMhderMhBiYEEsnJhADAyAxwJIJJgY2BHslYEGlEIRaVIoQJaHULXKpazexkziOP/Li5y85P26dO7x377nSOefe22JBE4lhkqmUfFETJwlFUTCfp3ieh2EY2LbNbKZQSqG1bvp1XVOWJXm+zM+jdf701zfYvLhK4A2wPm3j/D4gKwt0GhNFAUEwIU1FLNMiEgk2lX8umBZMkQoWx2Ej0lJC+OvOA7qXLzF89YKNCysExiGzvOLrd4+DoxG+H1EWGssO6Ww5HJ+MhDShKjU/ej4ft/rS88VpTktTs9N+yfraQ9pXHvFl5Soqjniz6XLzbpdb97sYf31xkPDk6T7X1na493gP1x1zaAbcuL3H6vVd2s8Nca2WI/t+yLvPDq+fdQiOTErB3MGE7W8Ouz9d2ZOWveWcWEM+dCx6f1wZLyVJNL39Pm/fn4rDMVWVLwm1MA+dY/quTV5VzXInoS+1JU7OyLKswcZTD/vMZBr4TR2nIaeeyWD0T47nymEW/AezBKyVHNWbdgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="Figure 4"\n        title=""\n        src="/static/09baf853f0a8a4f90786702e29fd0c47/5ebd7/00.png"\n        srcset="/static/09baf853f0a8a4f90786702e29fd0c47/06437/00.png 176w,\n/static/09baf853f0a8a4f90786702e29fd0c47/ba1c3/00.png 352w,\n/static/09baf853f0a8a4f90786702e29fd0c47/5ebd7/00.png 704w,\n/static/09baf853f0a8a4f90786702e29fd0c47/fd84e/00.png 1056w,\n/static/09baf853f0a8a4f90786702e29fd0c47/3fca6/00.png 1112w"\n        sizes="(max-width: 704px) 100vw, 704px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n    </span>\n    <figcaption class="gatsby-resp-image-figcaption">Figure 4</figcaption>\n  </figure>'}})),"\n",l.createElement(t.ol,null,"\n",l.createElement(t.li,null,"activation이 weight보다 quantization하기 어렵다.",l.createElement(t.br),"\n","weight의 분포는 꽤 평평하여 INT8 심지어 INT4로 quantize 하여도 정확도가 감소하지 않았다."),"\n",l.createElement(t.li,null,"outlier가 activation quantization을 어렵게 한다.\r\nactivation의 outlier는 다른 값보다 ~100배 더 크게 관측되었다.\r\n이러한 경우에 per-tensor quantization을 진행한다면 outlier에 의해 큰 quantization error를 만든다."),"\n",l.createElement(t.li,null,"outlier는 고정된 channel에 나타난다.\r\n만약 한 채널에 outlier가 있었다면, 해당 채널은 모든 토큰에서 outlier를 가진다.\r\n그래서 per-channel quantization을 per-tensor quantization보다 더 작은 quantization error를 가지게 된다.\r\n하지만 per-channel quantization은 ",l.createElement(t.em,null,l.createElement(t.strong,null,"GEMM"))," 커널에 적합하지 않다.",l.createElement(t.br),"\n",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<figure class="gatsby-resp-image-figure" style="">\n    <span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 530px; "\n    >\n      <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 32.38636363636364%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABJ0lEQVR42kVQXZOCMAzk//80Xw5xFAQpSqF8tQUU0Qdu9pLozD0wDZvN7iaBMQZh+IM0y3A+nxHHMXa7Hfq+h9Yl/SdYlgWn45GwARVh4T7C87lgH4aoqhpd22IfRZimCYG1FkmSwDmPeZ7pu+N+n0VEa00DlfSuRQHmGlPjerthHEfkeY6WxBhXSpHJEwEnOZK7dU5EHo+HNNgtPp1QFAq60pKeDcqyhCJxNkrTVF7W4FA8GzSNQURxD4cDMiLwa5oW27aJiFI53HcLTlOWNxHy3uNyuaCuazRNI9yVE1o7SPQ0zVCzKzX8OGH73SQNkzlt8V15GAa5G5+HsbbrZH2tK7xebwQc07oP0VpH93Lo+k4ScO29+69pkHkf3IsBi7Eh1+u64g/ZzbsPoi/EPwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="Table 1"\n        title=""\n        src="/static/d4d6fd03970823e88995de374281b5fe/b6a9b/01.png"\n        srcset="/static/d4d6fd03970823e88995de374281b5fe/06437/01.png 176w,\n/static/d4d6fd03970823e88995de374281b5fe/ba1c3/01.png 352w,\n/static/d4d6fd03970823e88995de374281b5fe/b6a9b/01.png 530w"\n        sizes="(max-width: 530px) 100vw, 530px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n    </span>\n    <figcaption class="gatsby-resp-image-figcaption">Table 1</figcaption>\n  </figure>'}})),"\n"),"\n",l.createElement(t.p,null,l.createElement(t.code,null,"GEMM 커널이 뭔지 찾아보자.")),"\n",l.createElement(t.h2,{id:"smoothquant"},"SmoothQuant"),"\n",l.createElement(t.p,null,"per-channel quantization 대신 smoothing factor ",l.createElement(t.span,{className:"math math-inline"},l.createElement(t.span,{className:"katex"},l.createElement(t.span,{className:"katex-mathml"},l.createElement(t.math,{xmlns:"http://www.w3.org/1998/Math/MathML"},l.createElement(t.semantics,null,l.createElement(t.mrow,null,l.createElement(t.mi,null,"s")),l.createElement(t.annotation,{encoding:"application/x-tex"},"s")))),l.createElement(t.span,{className:"katex-html","aria-hidden":"true"},l.createElement(t.span,{className:"base"},l.createElement(t.span,{className:"strut",style:{height:"0.4306em"}}),l.createElement(t.span,{className:"mord mathnormal"},"s"))))),"를 이용하여 linear layer의 동일한 수학적 결과를 만든다.\r\nquantization error를 줄이기 위해 모든 channel을 동일한 규모로 만든다."),"\n",l.createElement(t.div,{className:"math math-display"},l.createElement(t.span,{className:"katex-display"},l.createElement(t.span,{className:"katex"},l.createElement(t.span,{className:"katex-mathml"},l.createElement(t.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},l.createElement(t.semantics,null,l.createElement(t.mrow,null,l.createElement(t.msub,null,l.createElement(t.mi,null,"s"),l.createElement(t.mi,null,"j")),l.createElement(t.mo,null,"="),l.createElement(t.mi,null,"m"),l.createElement(t.mi,null,"a"),l.createElement(t.mi,null,"x"),l.createElement(t.mo,{stretchy:"false"},"("),l.createElement(t.mrow,null,l.createElement(t.mo,{fence:"true"},"∣"),l.createElement(t.msub,null,l.createElement(t.mi,null,"X"),l.createElement(t.mi,null,"j")),l.createElement(t.mo,{fence:"true"},"∣")),l.createElement(t.mo,{stretchy:"false"},")"),l.createElement(t.mo,{separator:"true"},","),l.createElement(t.mi,null,"j"),l.createElement(t.mo,null,"="),l.createElement(t.mn,null,"1"),l.createElement(t.mo,{separator:"true"},","),l.createElement(t.mn,null,"2"),l.createElement(t.mo,{separator:"true"},","),l.createElement(t.mo,null,"⋯"),l.createElement(t.mtext,null," "),l.createElement(t.mo,{separator:"true"},","),l.createElement(t.msub,null,l.createElement(t.mi,null,"C"),l.createElement(t.mi,null,"j"))),l.createElement(t.annotation,{encoding:"application/x-tex"},"s_j=max(\\left| X_j \\right|), j=1,2,\\cdots,C_j")))),l.createElement(t.span,{className:"katex-html","aria-hidden":"true"},l.createElement(t.span,{className:"base"},l.createElement(t.span,{className:"strut",style:{height:"0.7167em",verticalAlign:"-0.2861em"}}),l.createElement(t.span,{className:"mord"},l.createElement(t.span,{className:"mord mathnormal"},"s"),l.createElement(t.span,{className:"msupsub"},l.createElement(t.span,{className:"vlist-t vlist-t2"},l.createElement(t.span,{className:"vlist-r"},l.createElement(t.span,{className:"vlist",style:{height:"0.3117em"}},l.createElement(t.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"}},l.createElement(t.span,{className:"pstrut",style:{height:"2.7em"}}),l.createElement(t.span,{className:"sizing reset-size6 size3 mtight"},l.createElement(t.span,{className:"mord mathnormal mtight",style:{marginRight:"0.05724em"}},"j")))),l.createElement(t.span,{className:"vlist-s"},"​")),l.createElement(t.span,{className:"vlist-r"},l.createElement(t.span,{className:"vlist",style:{height:"0.2861em"}},l.createElement(t.span)))))),l.createElement(t.span,{className:"mspace",style:{marginRight:"0.2778em"}}),l.createElement(t.span,{className:"mrel"},"="),l.createElement(t.span,{className:"mspace",style:{marginRight:"0.2778em"}})),l.createElement(t.span,{className:"base"},l.createElement(t.span,{className:"strut",style:{height:"1.0361em",verticalAlign:"-0.2861em"}}),l.createElement(t.span,{className:"mord mathnormal"},"ma"),l.createElement(t.span,{className:"mord mathnormal"},"x"),l.createElement(t.span,{className:"mopen"},"("),l.createElement(t.span,{className:"minner"},l.createElement(t.span,{className:"mopen delimcenter",style:{top:"0em"}},"∣"),l.createElement(t.span,{className:"mord"},l.createElement(t.span,{className:"mord mathnormal",style:{marginRight:"0.07847em"}},"X"),l.createElement(t.span,{className:"msupsub"},l.createElement(t.span,{className:"vlist-t vlist-t2"},l.createElement(t.span,{className:"vlist-r"},l.createElement(t.span,{className:"vlist",style:{height:"0.3117em"}},l.createElement(t.span,{style:{top:"-2.55em",marginLeft:"-0.0785em",marginRight:"0.05em"}},l.createElement(t.span,{className:"pstrut",style:{height:"2.7em"}}),l.createElement(t.span,{className:"sizing reset-size6 size3 mtight"},l.createElement(t.span,{className:"mord mathnormal mtight",style:{marginRight:"0.05724em"}},"j")))),l.createElement(t.span,{className:"vlist-s"},"​")),l.createElement(t.span,{className:"vlist-r"},l.createElement(t.span,{className:"vlist",style:{height:"0.2861em"}},l.createElement(t.span)))))),l.createElement(t.span,{className:"mclose delimcenter",style:{top:"0em"}},"∣")),l.createElement(t.span,{className:"mclose"},")"),l.createElement(t.span,{className:"mpunct"},","),l.createElement(t.span,{className:"mspace",style:{marginRight:"0.1667em"}}),l.createElement(t.span,{className:"mord mathnormal",style:{marginRight:"0.05724em"}},"j"),l.createElement(t.span,{className:"mspace",style:{marginRight:"0.2778em"}}),l.createElement(t.span,{className:"mrel"},"="),l.createElement(t.span,{className:"mspace",style:{marginRight:"0.2778em"}})),l.createElement(t.span,{className:"base"},l.createElement(t.span,{className:"strut",style:{height:"0.9694em",verticalAlign:"-0.2861em"}}),l.createElement(t.span,{className:"mord"},"1"),l.createElement(t.span,{className:"mpunct"},","),l.createElement(t.span,{className:"mspace",style:{marginRight:"0.1667em"}}),l.createElement(t.span,{className:"mord"},"2"),l.createElement(t.span,{className:"mpunct"},","),l.createElement(t.span,{className:"mspace",style:{marginRight:"0.1667em"}}),l.createElement(t.span,{className:"minner"},"⋯"),l.createElement(t.span,{className:"mspace",style:{marginRight:"0.1667em"}}),l.createElement(t.span,{className:"mspace",style:{marginRight:"0.1667em"}}),l.createElement(t.span,{className:"mpunct"},","),l.createElement(t.span,{className:"mspace",style:{marginRight:"0.1667em"}}),l.createElement(t.span,{className:"mord"},l.createElement(t.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"}},"C"),l.createElement(t.span,{className:"msupsub"},l.createElement(t.span,{className:"vlist-t vlist-t2"},l.createElement(t.span,{className:"vlist-r"},l.createElement(t.span,{className:"vlist",style:{height:"0.3117em"}},l.createElement(t.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"}},l.createElement(t.span,{className:"pstrut",style:{height:"2.7em"}}),l.createElement(t.span,{className:"sizing reset-size6 size3 mtight"},l.createElement(t.span,{className:"mord mathnormal mtight",style:{marginRight:"0.05724em"}},"j")))),l.createElement(t.span,{className:"vlist-s"},"​")),l.createElement(t.span,{className:"vlist-r"},l.createElement(t.span,{className:"vlist",style:{height:"0.2861em"}},l.createElement(t.span))))))))))),"\n",l.createElement(t.p,null,"activation에 ",l.createElement(t.span,{className:"math math-inline"},l.createElement(t.span,{className:"katex"},l.createElement(t.span,{className:"katex-mathml"},l.createElement(t.math,{xmlns:"http://www.w3.org/1998/Math/MathML"},l.createElement(t.semantics,null,l.createElement(t.mrow,null,l.createElement(t.msub,null,l.createElement(t.mi,null,"s"),l.createElement(t.mi,null,"j"))),l.createElement(t.annotation,{encoding:"application/x-tex"},"s_j")))),l.createElement(t.span,{className:"katex-html","aria-hidden":"true"},l.createElement(t.span,{className:"base"},l.createElement(t.span,{className:"strut",style:{height:"0.7167em",verticalAlign:"-0.2861em"}}),l.createElement(t.span,{className:"mord"},l.createElement(t.span,{className:"mord mathnormal"},"s"),l.createElement(t.span,{className:"msupsub"},l.createElement(t.span,{className:"vlist-t vlist-t2"},l.createElement(t.span,{className:"vlist-r"},l.createElement(t.span,{className:"vlist",style:{height:"0.3117em"}},l.createElement(t.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"}},l.createElement(t.span,{className:"pstrut",style:{height:"2.7em"}}),l.createElement(t.span,{className:"sizing reset-size6 size3 mtight"},l.createElement(t.span,{className:"mord mathnormal mtight",style:{marginRight:"0.05724em"}},"j")))),l.createElement(t.span,{className:"vlist-s"},"​")),l.createElement(t.span,{className:"vlist-r"},l.createElement(t.span,{className:"vlist",style:{height:"0.2861em"}},l.createElement(t.span)))))))))),"를 나누어 모든 channel이 동일한 규모로 만들어 quantization error를 줄인다.\r\nactivation의 범위는 동적이기 때문에 몇몇의 calibration sample을 통해 scale을 추정해야 한다."),"\n",l.createElement(t.div,{className:"math math-display"},l.createElement(t.span,{className:"katex-display"},l.createElement(t.span,{className:"katex"},l.createElement(t.span,{className:"katex-mathml"},l.createElement(t.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},l.createElement(t.semantics,null,l.createElement(t.mrow,null,l.createElement(t.mi,null,"Y"),l.createElement(t.mo,null,"="),l.createElement(t.mo,{stretchy:"false"},"("),l.createElement(t.mi,null,"X"),l.createElement(t.mi,null,"d"),l.createElement(t.mi,null,"i"),l.createElement(t.mi,null,"a"),l.createElement(t.mi,null,"g"),l.createElement(t.mo,{stretchy:"false"},"("),l.createElement(t.mi,null,"s"),l.createElement(t.msup,null,l.createElement(t.mo,{stretchy:"false"},")"),l.createElement(t.mrow,null,l.createElement(t.mo,null,"−"),l.createElement(t.mn,null,"1"))),l.createElement(t.mo,{stretchy:"false"},")"),l.createElement(t.mo,null,"⋅"),l.createElement(t.mo,{stretchy:"false"},"("),l.createElement(t.mi,null,"d"),l.createElement(t.mi,null,"i"),l.createElement(t.mi,null,"a"),l.createElement(t.mi,null,"g"),l.createElement(t.mo,{stretchy:"false"},"("),l.createElement(t.mi,null,"s"),l.createElement(t.mo,{stretchy:"false"},")"),l.createElement(t.mi,null,"W"),l.createElement(t.mo,{stretchy:"false"},")"),l.createElement(t.mo,null,"="),l.createElement(t.mover,{accent:"true"},l.createElement(t.mi,null,"X"),l.createElement(t.mo,null,"^")),l.createElement(t.mover,{accent:"true"},l.createElement(t.mi,null,"Y"),l.createElement(t.mo,null,"^"))),l.createElement(t.annotation,{encoding:"application/x-tex"},"Y=(Xdiag(s)^{-1})\\cdot(diag(s)W)=\\hat{X}\\hat{Y}")))),l.createElement(t.span,{className:"katex-html","aria-hidden":"true"},l.createElement(t.span,{className:"base"},l.createElement(t.span,{className:"strut",style:{height:"0.6833em"}}),l.createElement(t.span,{className:"mord mathnormal",style:{marginRight:"0.22222em"}},"Y"),l.createElement(t.span,{className:"mspace",style:{marginRight:"0.2778em"}}),l.createElement(t.span,{className:"mrel"},"="),l.createElement(t.span,{className:"mspace",style:{marginRight:"0.2778em"}})),l.createElement(t.span,{className:"base"},l.createElement(t.span,{className:"strut",style:{height:"1.1141em",verticalAlign:"-0.25em"}}),l.createElement(t.span,{className:"mopen"},"("),l.createElement(t.span,{className:"mord mathnormal",style:{marginRight:"0.07847em"}},"X"),l.createElement(t.span,{className:"mord mathnormal"},"d"),l.createElement(t.span,{className:"mord mathnormal"},"ia"),l.createElement(t.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"}},"g"),l.createElement(t.span,{className:"mopen"},"("),l.createElement(t.span,{className:"mord mathnormal"},"s"),l.createElement(t.span,{className:"mclose"},l.createElement(t.span,{className:"mclose"},")"),l.createElement(t.span,{className:"msupsub"},l.createElement(t.span,{className:"vlist-t"},l.createElement(t.span,{className:"vlist-r"},l.createElement(t.span,{className:"vlist",style:{height:"0.8641em"}},l.createElement(t.span,{style:{top:"-3.113em",marginRight:"0.05em"}},l.createElement(t.span,{className:"pstrut",style:{height:"2.7em"}}),l.createElement(t.span,{className:"sizing reset-size6 size3 mtight"},l.createElement(t.span,{className:"mord mtight"},l.createElement(t.span,{className:"mord mtight"},"−"),l.createElement(t.span,{className:"mord mtight"},"1"))))))))),l.createElement(t.span,{className:"mclose"},")"),l.createElement(t.span,{className:"mspace",style:{marginRight:"0.2222em"}}),l.createElement(t.span,{className:"mbin"},"⋅"),l.createElement(t.span,{className:"mspace",style:{marginRight:"0.2222em"}})),l.createElement(t.span,{className:"base"},l.createElement(t.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),l.createElement(t.span,{className:"mopen"},"("),l.createElement(t.span,{className:"mord mathnormal"},"d"),l.createElement(t.span,{className:"mord mathnormal"},"ia"),l.createElement(t.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"}},"g"),l.createElement(t.span,{className:"mopen"},"("),l.createElement(t.span,{className:"mord mathnormal"},"s"),l.createElement(t.span,{className:"mclose"},")"),l.createElement(t.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"}},"W"),l.createElement(t.span,{className:"mclose"},")"),l.createElement(t.span,{className:"mspace",style:{marginRight:"0.2778em"}}),l.createElement(t.span,{className:"mrel"},"="),l.createElement(t.span,{className:"mspace",style:{marginRight:"0.2778em"}})),l.createElement(t.span,{className:"base"},l.createElement(t.span,{className:"strut",style:{height:"0.9468em"}}),l.createElement(t.span,{className:"mord accent"},l.createElement(t.span,{className:"vlist-t"},l.createElement(t.span,{className:"vlist-r"},l.createElement(t.span,{className:"vlist",style:{height:"0.9468em"}},l.createElement(t.span,{style:{top:"-3em"}},l.createElement(t.span,{className:"pstrut",style:{height:"3em"}}),l.createElement(t.span,{className:"mord mathnormal",style:{marginRight:"0.07847em"}},"X")),l.createElement(t.span,{style:{top:"-3.2523em"}},l.createElement(t.span,{className:"pstrut",style:{height:"3em"}}),l.createElement(t.span,{className:"accent-body",style:{left:"-0.1667em"}},l.createElement(t.span,{className:"mord"},"^"))))))),l.createElement(t.span,{className:"mord accent"},l.createElement(t.span,{className:"vlist-t"},l.createElement(t.span,{className:"vlist-r"},l.createElement(t.span,{className:"vlist",style:{height:"0.9468em"}},l.createElement(t.span,{style:{top:"-3em"}},l.createElement(t.span,{className:"pstrut",style:{height:"3em"}}),l.createElement(t.span,{className:"mord mathnormal",style:{marginRight:"0.22222em"}},"Y")),l.createElement(t.span,{style:{top:"-3.2523em"}},l.createElement(t.span,{className:"pstrut",style:{height:"3em"}}),l.createElement(t.span,{className:"accent-body",style:{left:"-0.25em"}},l.createElement(t.span,{className:"mord"},"^")))))))))))),"\n",l.createElement(t.p,null,"동일한 수학적 계산을 위해 weight에 앞서 구한 ",l.createElement(t.span,{className:"math math-inline"},l.createElement(t.span,{className:"katex"},l.createElement(t.span,{className:"katex-mathml"},l.createElement(t.math,{xmlns:"http://www.w3.org/1998/Math/MathML"},l.createElement(t.semantics,null,l.createElement(t.mrow,null,l.createElement(t.msub,null,l.createElement(t.mi,null,"s"),l.createElement(t.mi,null,"j"))),l.createElement(t.annotation,{encoding:"application/x-tex"},"s_j")))),l.createElement(t.span,{className:"katex-html","aria-hidden":"true"},l.createElement(t.span,{className:"base"},l.createElement(t.span,{className:"strut",style:{height:"0.7167em",verticalAlign:"-0.2861em"}}),l.createElement(t.span,{className:"mord"},l.createElement(t.span,{className:"mord mathnormal"},"s"),l.createElement(t.span,{className:"msupsub"},l.createElement(t.span,{className:"vlist-t vlist-t2"},l.createElement(t.span,{className:"vlist-r"},l.createElement(t.span,{className:"vlist",style:{height:"0.3117em"}},l.createElement(t.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"}},l.createElement(t.span,{className:"pstrut",style:{height:"2.7em"}}),l.createElement(t.span,{className:"sizing reset-size6 size3 mtight"},l.createElement(t.span,{className:"mord mathnormal mtight",style:{marginRight:"0.05724em"}},"j")))),l.createElement(t.span,{className:"vlist-s"},"​")),l.createElement(t.span,{className:"vlist-r"},l.createElement(t.span,{className:"vlist",style:{height:"0.2861em"}},l.createElement(t.span)))))))))),"를 곱해준다.\r\n하지만 이러한 방법은 quantization error를 activation에서 weight로 이동시키는 역할을 할 뿐이다.\r\n그래서 quantization difficulty를 weight와 activation이 적절하게 부담할 수 있도록 할 필요가 있다."),"\n",l.createElement(t.p,null,"quantization difficulty를 weight와 activation이 부담하는 정도를 결정하기 위해서 hyper-parameter ",l.createElement(t.span,{className:"math math-inline"},l.createElement(t.span,{className:"katex"},l.createElement(t.span,{className:"katex-mathml"},l.createElement(t.math,{xmlns:"http://www.w3.org/1998/Math/MathML"},l.createElement(t.semantics,null,l.createElement(t.mrow,null,l.createElement(t.mi,null,"α")),l.createElement(t.annotation,{encoding:"application/x-tex"},"\\alpha")))),l.createElement(t.span,{className:"katex-html","aria-hidden":"true"},l.createElement(t.span,{className:"base"},l.createElement(t.span,{className:"strut",style:{height:"0.4306em"}}),l.createElement(t.span,{className:"mord mathnormal",style:{marginRight:"0.0037em"}},"α"))))),"를 추가한다"),"\n",l.createElement(t.div,{className:"math math-display"},l.createElement(t.span,{className:"katex-display"},l.createElement(t.span,{className:"katex"},l.createElement(t.span,{className:"katex-mathml"},l.createElement(t.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},l.createElement(t.semantics,null,l.createElement(t.mrow,null,l.createElement(t.msub,null,l.createElement(t.mi,null,"s"),l.createElement(t.mi,null,"j")),l.createElement(t.mo,null,"="),l.createElement(t.mi,null,"m"),l.createElement(t.mi,null,"a"),l.createElement(t.mi,null,"x"),l.createElement(t.mo,{stretchy:"false"},"("),l.createElement(t.mrow,null,l.createElement(t.mo,{fence:"true"},"∣"),l.createElement(t.msub,null,l.createElement(t.mi,null,"X"),l.createElement(t.mi,null,"j")),l.createElement(t.mo,{fence:"true"},"∣")),l.createElement(t.msup,null,l.createElement(t.mo,{stretchy:"false"},")"),l.createElement(t.mi,null,"α")),l.createElement(t.mi,{mathvariant:"normal"},"/"),l.createElement(t.mi,null,"m"),l.createElement(t.mi,null,"a"),l.createElement(t.mi,null,"x"),l.createElement(t.mo,{stretchy:"false"},"("),l.createElement(t.mrow,null,l.createElement(t.mo,{fence:"true"},"∣"),l.createElement(t.msub,null,l.createElement(t.mi,null,"W"),l.createElement(t.mi,null,"j")),l.createElement(t.mo,{fence:"true"},"∣")),l.createElement(t.msup,null,l.createElement(t.mo,{stretchy:"false"},")"),l.createElement(t.mrow,null,l.createElement(t.mn,null,"1"),l.createElement(t.mo,null,"−"),l.createElement(t.mi,null,"α")))),l.createElement(t.annotation,{encoding:"application/x-tex"},"s_j=max(\\left| X_j \\right|)^{\\alpha}/max(\\left| W_j \\right|)^{1-\\alpha}")))),l.createElement(t.span,{className:"katex-html","aria-hidden":"true"},l.createElement(t.span,{className:"base"},l.createElement(t.span,{className:"strut",style:{height:"0.7167em",verticalAlign:"-0.2861em"}}),l.createElement(t.span,{className:"mord"},l.createElement(t.span,{className:"mord mathnormal"},"s"),l.createElement(t.span,{className:"msupsub"},l.createElement(t.span,{className:"vlist-t vlist-t2"},l.createElement(t.span,{className:"vlist-r"},l.createElement(t.span,{className:"vlist",style:{height:"0.3117em"}},l.createElement(t.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"}},l.createElement(t.span,{className:"pstrut",style:{height:"2.7em"}}),l.createElement(t.span,{className:"sizing reset-size6 size3 mtight"},l.createElement(t.span,{className:"mord mathnormal mtight",style:{marginRight:"0.05724em"}},"j")))),l.createElement(t.span,{className:"vlist-s"},"​")),l.createElement(t.span,{className:"vlist-r"},l.createElement(t.span,{className:"vlist",style:{height:"0.2861em"}},l.createElement(t.span)))))),l.createElement(t.span,{className:"mspace",style:{marginRight:"0.2778em"}}),l.createElement(t.span,{className:"mrel"},"="),l.createElement(t.span,{className:"mspace",style:{marginRight:"0.2778em"}})),l.createElement(t.span,{className:"base"},l.createElement(t.span,{className:"strut",style:{height:"1.1502em",verticalAlign:"-0.2861em"}}),l.createElement(t.span,{className:"mord mathnormal"},"ma"),l.createElement(t.span,{className:"mord mathnormal"},"x"),l.createElement(t.span,{className:"mopen"},"("),l.createElement(t.span,{className:"minner"},l.createElement(t.span,{className:"mopen delimcenter",style:{top:"0em"}},"∣"),l.createElement(t.span,{className:"mord"},l.createElement(t.span,{className:"mord mathnormal",style:{marginRight:"0.07847em"}},"X"),l.createElement(t.span,{className:"msupsub"},l.createElement(t.span,{className:"vlist-t vlist-t2"},l.createElement(t.span,{className:"vlist-r"},l.createElement(t.span,{className:"vlist",style:{height:"0.3117em"}},l.createElement(t.span,{style:{top:"-2.55em",marginLeft:"-0.0785em",marginRight:"0.05em"}},l.createElement(t.span,{className:"pstrut",style:{height:"2.7em"}}),l.createElement(t.span,{className:"sizing reset-size6 size3 mtight"},l.createElement(t.span,{className:"mord mathnormal mtight",style:{marginRight:"0.05724em"}},"j")))),l.createElement(t.span,{className:"vlist-s"},"​")),l.createElement(t.span,{className:"vlist-r"},l.createElement(t.span,{className:"vlist",style:{height:"0.2861em"}},l.createElement(t.span)))))),l.createElement(t.span,{className:"mclose delimcenter",style:{top:"0em"}},"∣")),l.createElement(t.span,{className:"mclose"},l.createElement(t.span,{className:"mclose"},")"),l.createElement(t.span,{className:"msupsub"},l.createElement(t.span,{className:"vlist-t"},l.createElement(t.span,{className:"vlist-r"},l.createElement(t.span,{className:"vlist",style:{height:"0.7144em"}},l.createElement(t.span,{style:{top:"-3.113em",marginRight:"0.05em"}},l.createElement(t.span,{className:"pstrut",style:{height:"2.7em"}}),l.createElement(t.span,{className:"sizing reset-size6 size3 mtight"},l.createElement(t.span,{className:"mord mtight"},l.createElement(t.span,{className:"mord mathnormal mtight",style:{marginRight:"0.0037em"}},"α"))))))))),l.createElement(t.span,{className:"mord"},"/"),l.createElement(t.span,{className:"mord mathnormal"},"ma"),l.createElement(t.span,{className:"mord mathnormal"},"x"),l.createElement(t.span,{className:"mopen"},"("),l.createElement(t.span,{className:"minner"},l.createElement(t.span,{className:"mopen delimcenter",style:{top:"0em"}},"∣"),l.createElement(t.span,{className:"mord"},l.createElement(t.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"}},"W"),l.createElement(t.span,{className:"msupsub"},l.createElement(t.span,{className:"vlist-t vlist-t2"},l.createElement(t.span,{className:"vlist-r"},l.createElement(t.span,{className:"vlist",style:{height:"0.3117em"}},l.createElement(t.span,{style:{top:"-2.55em",marginLeft:"-0.1389em",marginRight:"0.05em"}},l.createElement(t.span,{className:"pstrut",style:{height:"2.7em"}}),l.createElement(t.span,{className:"sizing reset-size6 size3 mtight"},l.createElement(t.span,{className:"mord mathnormal mtight",style:{marginRight:"0.05724em"}},"j")))),l.createElement(t.span,{className:"vlist-s"},"​")),l.createElement(t.span,{className:"vlist-r"},l.createElement(t.span,{className:"vlist",style:{height:"0.2861em"}},l.createElement(t.span)))))),l.createElement(t.span,{className:"mclose delimcenter",style:{top:"0em"}},"∣")),l.createElement(t.span,{className:"mclose"},l.createElement(t.span,{className:"mclose"},")"),l.createElement(t.span,{className:"msupsub"},l.createElement(t.span,{className:"vlist-t"},l.createElement(t.span,{className:"vlist-r"},l.createElement(t.span,{className:"vlist",style:{height:"0.8641em"}},l.createElement(t.span,{style:{top:"-3.113em",marginRight:"0.05em"}},l.createElement(t.span,{className:"pstrut",style:{height:"2.7em"}}),l.createElement(t.span,{className:"sizing reset-size6 size3 mtight"},l.createElement(t.span,{className:"mord mtight"},l.createElement(t.span,{className:"mord mtight"},"1"),l.createElement(t.span,{className:"mbin mtight"},"−"),l.createElement(t.span,{className:"mord mathnormal mtight",style:{marginRight:"0.0037em"}},"α")))))))))))))),"\n",l.createElement(t.p,null,l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<figure class="gatsby-resp-image-figure" style="">\n    <span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 535px; "\n    >\n      <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 36.36363636363637%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABrUlEQVR42l2Ry2/TQBDG8/9fOcAFwaFCVIiKQ1uJkqRqKeTh2I7xI35sHNuxXNfNQxDiOInDj024MdJq5pud+b7dmQbSssdHHNtmuVgcIX8Oh5M/SP9rtWK9XlPXNXmeE4Yhvu8Rx5HM7fnfGicCefbystpWp+SxeVbkpPEEVemiawOeJa42FavfJfPlT2bzObtdzUoKHoWKomA+X9A4viJNY4ZXN+jNe/LgjkfRwfqhEIwUPFvB0DtEY0eSLAiMNm7vHK3XIgm+kYYGQr3EH1wSmA80sixD0/rY717gtj6RfH9NcPsWz3cQgcHIUbFMlSQZUzzleFoToV0Tu1+ZWBdM7TZZ75Xse8nUuKIRRxG6PiBsf5SFd0y6F2TqDYFjIvwhnqlg6QpR6DF7LiTuEthdxKhD4kmyxCd0HhDWPcJVaVRVRRDY9M4+0P/cJFPOKdRrLNfEsvqYZh9XxpOJz1LOLrK+EA/fM/Y7pH6LPFIQgzdExpkUuP23lPpQsytL9tst9a6k3m7YyvhJfrEs1+z3OzabUhIuiaNQjsJFCJ+x8JhOY7I0Ihy7p8X9BTaY+SpERuwPAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="Figure 5"\n        title=""\n        src="/static/db0998625891bd17a196749031a64e82/b5245/02.png"\n        srcset="/static/db0998625891bd17a196749031a64e82/06437/02.png 176w,\n/static/db0998625891bd17a196749031a64e82/ba1c3/02.png 352w,\n/static/db0998625891bd17a196749031a64e82/b5245/02.png 535w"\n        sizes="(max-width: 535px) 100vw, 535px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n    </span>\n    <figcaption class="gatsby-resp-image-figcaption">Figure 5</figcaption>\n  </figure>'}}),l.createElement(t.br),"\n",l.createElement(t.span,{className:"math math-inline"},l.createElement(t.span,{className:"katex"},l.createElement(t.span,{className:"katex-mathml"},l.createElement(t.math,{xmlns:"http://www.w3.org/1998/Math/MathML"},l.createElement(t.semantics,null,l.createElement(t.mrow,null,l.createElement(t.mi,null,"α")),l.createElement(t.annotation,{encoding:"application/x-tex"},"\\alpha")))),l.createElement(t.span,{className:"katex-html","aria-hidden":"true"},l.createElement(t.span,{className:"base"},l.createElement(t.span,{className:"strut",style:{height:"0.4306em"}}),l.createElement(t.span,{className:"mord mathnormal",style:{marginRight:"0.0037em"}},"α"))))),"를 큰 값으로 설정하여 quantization difficulty를 weight에 더 부담하는 등 hyper-parameter의 조절을 통해 quantization difficulty를 조절할 수 있다.\r\n대부분의 모델에서 ",l.createElement(t.span,{className:"math math-inline"},l.createElement(t.span,{className:"katex"},l.createElement(t.span,{className:"katex-mathml"},l.createElement(t.math,{xmlns:"http://www.w3.org/1998/Math/MathML"},l.createElement(t.semantics,null,l.createElement(t.mrow,null,l.createElement(t.mi,null,"α"),l.createElement(t.mo,null,"="),l.createElement(t.mn,null,"0.5")),l.createElement(t.annotation,{encoding:"application/x-tex"},"\\alpha=0.5")))),l.createElement(t.span,{className:"katex-html","aria-hidden":"true"},l.createElement(t.span,{className:"base"},l.createElement(t.span,{className:"strut",style:{height:"0.4306em"}}),l.createElement(t.span,{className:"mord mathnormal",style:{marginRight:"0.0037em"}},"α"),l.createElement(t.span,{className:"mspace",style:{marginRight:"0.2778em"}}),l.createElement(t.span,{className:"mrel"},"="),l.createElement(t.span,{className:"mspace",style:{marginRight:"0.2778em"}})),l.createElement(t.span,{className:"base"},l.createElement(t.span,{className:"strut",style:{height:"0.6444em"}}),l.createElement(t.span,{className:"mord"},"0.5"))))),"에서 균형을 갖춘 quantization difficulty를 확인할 수 있었다."),"\n",l.createElement(t.p,null,"기본적으로 self-attention과 feed-forward layer에 대해 smoothing을 적용하였다.\r\nReLU, Softmax, 그리고 Layer-Norm과 같은 연산은 FP16으로 유지하였고,\r\n무거운 연산을 하는 linear layer와 BMM(Batched Matrix Multiplication)에 대해 W8A8(weight 8 actication 8) quantization을 적용하였다.\r\n",l.createElement(t.span,{dangerouslySetInnerHTML:{__html:'<figure class="gatsby-resp-image-figure" style="">\n    <span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 513px; "\n    >\n      <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 63.63636363636363%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADQElEQVR42j2T2U8bVxTG/bf0rX3qU/+QSlWlPlSqmqqqlKKkEKzUbMGgJE0hqFXTqn1IWggQCGUxZbBZzJJAoCwB4y2BGuyxPbbH4/EGZrz8csduckdHOldndO73ne87loSioIR9xCM+ouEA8pmf+NkBsdAWKTWFkkiSSKn1PJ1WUVMpMprGyfExAb8fTRW1WIiTrb+IxWJYMhmNaimBeQqhUaIz7+F98iH7gx/gefIRyfn3KcrOep1ahVqtVk9lWcbnC1C60MlnI2yv96GKRy26aFi5SJG7LLHj/Zu99XY2VrpxzDWxvWZn/1k7L4MS50aZasWgcnlOxSgihwVC7wGZvIaSVRjfna6jt+RzWXTtlNvzdq4ON2Gbu02b1Mv1pzZsUg/fTbVzZehL7jp7OddjlEs5ytUKVRNwtSzuWd6edDqNJZfVuSwoSIcz/Lx4j7GNQUae/cmD5T4ce+O8jvvZPH5OKPUfhvjPJJzcvcOp9AmHE5/hefoxrxyfoqx+TfQs2GhYyisMrP+GbcFOy1ALLcNWbC4799d+pVqtEdfjVGtVysVkvWEu5CT0vI8d1w+sz3Xyam0A3T9MMh7Bks1mMIoJErv9nLqbOZi5imf2GuGVZhI7/fWGMUG1IugZ5w3xpo/mubl4C+ukTYzESttyN5MeSYwuazZsUE7s3EF2f8va+BdsTHxFdLUJ+YWdQrFAMBbEKF8K8VQMw2DJ48SxP8nMi1FmNx6KfIqlQwlFiTcon+fi9C4PcE1q43t3NzccnXzzyMpNyY7N2cqVsc/5yd0PQgC9oDPg/hH7fCetg81YR67T4+rivvseJ2cnAqGeqdvmRAzfG95lYusxv0h99Iy18cDZz+TuBP6oj7B6RrWO8JKlIxezninGt0f5Y+V3/vE4WPS6BEJF+FA3ja2+k35w8xE3hpppF8K0jrQw+u9ww9PiM4pKPV/0LdDl6qBruoOOsVY65204vRJZc4amu/PqMXktIiIsIoquHPFy4S459VTc5f9rEfSEl3xGFswV4ckk8YCL4OZDMV+E2ctiTRVTlCyapor9bIS5OZqqEH69h55OiXv6Xe1taFoKU8yEHCASXCVXuMBcYV3XeQMYTnigp5Xv7gAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="Figure 6"\n        title=""\n        src="/static/85ec202d4024106aa2c583828fbb1927/267f6/03.png"\n        srcset="/static/85ec202d4024106aa2c583828fbb1927/06437/03.png 176w,\n/static/85ec202d4024106aa2c583828fbb1927/ba1c3/03.png 352w,\n/static/85ec202d4024106aa2c583828fbb1927/267f6/03.png 513w"\n        sizes="(max-width: 513px) 100vw, 513px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n    </span>\n    <figcaption class="gatsby-resp-image-figcaption">Figure 6</figcaption>\n  </figure>'}})),"\n",l.createElement(t.p,null,l.createElement(t.code,null,"그럼 caplibration sample data가 많을 수록 더 정확한 scale값을 추정할 수 있다고 말할 수 있을까?")),"\n",l.createElement(t.h2,{id:"experiments"},"Experiments"),"\n",l.createElement(t.p,null,l.createElement(t.img,{src:"04.png",alt:"Table 2"}),l.createElement(t.br),"\n","효율은 SmoothQuant-O1에서 SmoothQuant-O3로 갈수록 증가하였다."),"\n",l.createElement(t.h1,{id:"implement"},"Implement"),"\n",l.createElement(t.p,null,"위 논문을 바탕으로 구현을 시작해 봅시다."),"\n",l.createElement(t.h2,{id:"fakequant"},"FakeQuant"),"\n",l.createElement(t.p,null,"pytorch는 실제로 int8 연산을 지원하지 않기 때문에 float32 연산이지만 quantization을 하는 것 처럼 즉 fake quantization을 만들어 볼게요.\r\nquantization을 어떤 범위로 하느냐에 따라 per-tensor, per-token, per-channel 등 여러 종류가 있지만 per-tensor로 구현을 해봅시다."),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"language-python"},"@torch.no_grad()\r\ndef quantize_symmetric_per_tensor(tensor:torch.Tensor, n_bits:int):\r\n    t_max = torch.max(torch.abs(tensor))\r\n    q_max = 2**(n_bits - 1) - 1\r\n    scale = t_max.clamp(EPS).div(q_max)\r\n    q_tensor = tensor.div(scale).round()\r\n    return q_tensor, scale, torch.tensor(0)\n")),"\n",l.createElement(t.p,null,"quantization시 텐서가 가지고 있는 규모를 n bit에 나눠서 분할하기 때문에 크기를 조절해주는 scale을 구합니다.\r\n이를 이용해서 tensor를 quantization 해보았어요.",l.createElement(t.br),"\n","그럼 matmul 연산을 이용하여 테스트를 해 볼까요?"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"language-python"},"def matmul_with_quantize(t1, t2, quantize):\r\n    q1, s1, z1 = quantize(t1, 8)\r\n    q2, s2, z2 = quantize(t2, 8)\r\n    return torch.matmul(q1+z1, (q2+z2).T) * s1 * s2\r\n\r\ntorch.manual_seed(42)\r\nt1 = torch.rand(128, 768) * 2 - 1\r\nt2 = torch.rand(128, 768) * 2 - 1\r\nmatmul_result = torch.matmul(t1, t2.T)\r\nq_matmul_result = matmul_with_quantize(t1, t2, quantize_symmetric_per_tensor)\r\nprint('MSE loss', F.mse_loss(matmul_result, q_matmul_result))\n")),"\n",l.createElement(t.pre,null,l.createElement(t.code,null,"MSE loss tensor(0.0027)\n")),"\n",l.createElement(t.p,null,"quantized된 두 tensor를 이용하여 연산을 진행한 후 원래 크기로 돌려주기 위해 scale값을 곱해줍니다.\r\n평균 제곱 오차를 구하면 약 0.0027 정도가 되네요."),"\n",l.createElement(t.p,null,"위 방법은 0을 기준으로 양수와 음수를 같은 규모로 양자화를 적용하는 symmetric quantization 이에요.\r\n만약에 tensor가 0을 기준으로 양수 혹은 음수에 조금 더 많이 분포하는 경향이 있으면 이 방법은 비효율적이죠.\r\n아래 예시를 보겠습니다."),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"language-python"},"t1 = t1 + 10\r\nt2 = t2 - 10\r\nq_matmul_result = matmul_with_quantize(t1, t2, quantize_symmetric_per_tensor)\r\nprint('MSE loss', F.mse_loss(matmul_result, q_matmul_result))\n")),"\n",l.createElement(t.pre,null,l.createElement(t.code,null,"MSE loss tensor(84.2358)\n")),"\n",l.createElement(t.p,null,"극단적으로 t1은 전부 양수값을 가지도록, t2는 전부 음수값을 가지도록 설정해보았어요.\r\n그 후 symmetric quantization을 진행하였는데 기존 값과 오차가 훨씬 큰 것을 볼 수 있어요."),"\n",l.createElement(t.p,null,"이런 친구들을 위해 0 기준 양쪽에 bit를 동등하게 할당하지 않고 tensor의 최대 최소값을 구한 후 중앙값을 0으로 만들어주는 전략을 취한다면?\r\n사실 앞서 quantize 함수에서 quantized된 tensor와 scale 값, 그리고 또 하나의 값을 반환하였어요.\r\n이것이 중앙값을 0으로 만들어주는 일종의 offset 개념인 zero point 입니다.\r\n우리는 zero point를 이용하여 asymmetric quantizatio을 만들어 봅시다."),"\n",l.createElement(t.pre,null,l.createElement(t.code,null,"@torch.no_grad()\r\ndef quantize_asymmetric_per_tensor(tensor:torch.Tensor, n_bits:int):\r\n    t_max = torch.max(tensor)\r\n    t_min = torch.min(tensor)\r\n    scale = (t_max - t_min) / (2**n_bits - 1)\r\n    zero_point = torch.round((t_max + t_min)/ 2 / scale)\r\n    q_tensor = torch.round(tensor / scale) - zero_point\r\n    return q_tensor, scale, zero_point\n")),"\n",l.createElement(t.p,null,"tensor의 최대 최소값의 범위만큼 bit를 할당하도록 scale값과 할당된 bit의 중앙값을 설정하는 zero point를 구하였습니다.\r\n이를 사용하여 아까 편향된 텐서를 계산해서 기존 결과와 얼마나 차이가 나는지 테스트 해 보겠습니다."),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"language-python"},"q_matmul_result = matmul_with_quantize(t1, t2, quantize_asymmetric_per_tensor)\r\nprint('MSE loss', F.mse_loss(matmul_result, q_matmul_result))\n")),"\n",l.createElement(t.pre,null,l.createElement(t.code,null,"MSE loss tensor(0.6758)\n")),"\n",l.createElement(t.p,null,"symmetric quantization 방법과 비교하면 loss가 크게 감소한 것을 볼 수 있네요."),"\n",l.createElement(t.p,null,"이렇게 보면 asymmetric quantization이 무조건 좋은 방법처럼 보이지만 symmetric에 비해 추가적인 연산을 해야 하는 부분이 있죠.\r\n그래서 두 가지 방법을 적절하게 사용하는 능력이 중요할 것 같네요."),"\n",l.createElement(t.h2,{id:"fakequantlinear"},"FakeQuantLinear"),"\n",l.createElement(t.p,null,"이제 fake quantization을 이용하여 기존 Linear 모듈에 대한 연산을 int8 연산처럼 보이도록 만들어 봅시다.\r\nLinear는 기본적으로 input과 weight를 matmul 연산 후 bias를 더하는 형태로 구성됩니다."),"\n",l.createElement(t.p,null,"위 구현을 진행하다\r\nFakeQuant를 구현하면서 float16 모델에 대한 quantization을 진행하던 도중 clamp와 round 함수에 오류가 발생했다.\r\n알고보니 float16에 대한 clamp, round와 같은 연산은 cpu에서 불가능하고 cuda를 통해서만 가능하였다."))}var m=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,n.ah)(),e.components);return t?l.createElement(t,e,l.createElement(s,e)):s(e)},r=a(4316),c=a(1840),i=a(7821),p=a(2654),o=a(4111),E=a(2726),g=a(4480),h=a(2818),u=a(9213),A=a(7213),d=a(9265),N=a(9601),y=a(3071),f=a(6097),b=a(6782),v=a(4891),w=a(3387),x=a(917);const z=e=>{let{data:{mdx:t},children:a}=e;const s=(0,g.sJ)((0,h.cp)(h.eE,!1)),m=(0,g.sJ)((0,h.cp)(h.rf,!1)),r=(0,g.Zl)((0,h.cp)(h.Cy,t.tableOfContents.items));return(0,l.useEffect)((()=>{r(t.tableOfContents.items)}),[t]),(0,x.tZ)(c.Z,null,(0,x.tZ)(R,null,(0,x.tZ)(o.Z,null)),(0,x.tZ)(k,null,(0,x.tZ)(q,{className:"navigation",isNavOpened:m},(0,x.tZ)(M,{className:"hide_scroll"},(0,x.tZ)(i.Z,null))),(0,x.tZ)(_,{isNavOpened:m},(0,x.tZ)(j,{isWide:s},(0,x.tZ)(E.Z,{title:t.frontmatter.title,date:t.frontmatter.date}),(0,x.tZ)(n.Zo,{components:{p:A.Z,h1:d.H1,h2:d.H2,h3:d.H3,h4:d.H4,h5:d.H5,h6:d.H6,hr:N.Z,blockquote:y.Z,ul:b.Z,ol:f.Z,pre:v.Z,code:w.Z}},a))),(0,x.tZ)(B,null,(0,x.tZ)(L,null,(0,x.tZ)(p.Z,null)))))},R=(0,r.Z)("div",{target:"e1ojob7j7"})({name:"11t2x7x",styles:"display:flex;height:var(--header-height);z-index:5;padding:0.6rem 2rem 0.6rem 0.6rem;position:fixed;width:100%;background:var(--background-color);border-bottom:1px solid var(--border-color)"}),k=(0,r.Z)("div",{target:"e1ojob7j6"})({name:"majwgz",styles:"position:relative;display:flex;min-height:calc(100vh - var(--header-height));overflow-x:hidden"}),q=(0,r.Z)("aside",{target:"e1ojob7j5"})("margin-left:",(e=>e.isNavOpened?"0":"calc(-1 * var(--sidebar-width))"),";flex:0 0 var(--sidebar-width);font-size:0.875rem;overflow-x:hidden;overflow-y:auto;transition:margin 0.25s var(--ease-in-out-quad);@media (min-width: ",u.Z.IPAD_PRO,"px){margin-left:0;}"),M=(0,r.Z)("nav",{target:"e1ojob7j4"})({name:"l4vzaw",styles:"overflow-y:auto;height:100%;padding:var(--body-padding-top) 0 3rem 0;position:fixed;width:var(--sidebar-width);&:-webkit-scrollbar{display:none;}"}),j=(0,r.Z)("main",{target:"e1ojob7j3"})("padding:1rem;width:100%;@media (min-width: ",u.Z.IPAD_AIR,"px){width:",(e=>e.isWide?"90%":"65%"),";}"),_=(0,r.Z)("main",{target:"e1ojob7j2"})("width:calc(100% - 2 * var(--sidebar-width));padding-top:var(--body-padding-top);flex-grow:1;min-width:20rem;display:flex;justify-content:center;opacity:",(e=>e.isNavOpened?.3:1),";@media (min-width: ",u.Z.IPAD_PRO,"px){opacity:1;}"),B=(0,r.Z)("aside",{target:"e1ojob7j1"})("font-size:0.75rem;font-weight:bold;overflow-x:hidden;overflow-y:auto;padding-top:var(--body-padding-top);width:0;transition:width 0.25s var(--ease-in-out-quad);@media (min-width: ",u.Z.HD,"px){width:var(--sidebar-width);}"),L=(0,r.Z)(M,{target:"e1ojob7j0"})({name:"b40oxt",styles:"padding:0 1rem 0 1rem"});function Q(e){return l.createElement(z,e,l.createElement(m,e))}}}]);
//# sourceMappingURL=component---src-components-templates-main-template-tsx-content-file-path-contents-paper-quantization-smooth-quant-smooth-quant-mdx-25f37d845896b3fe27ad.js.map